
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Real-Time%20Chat%20Application/">
      
      
        <link rel="next" href="../aws-cloudtrail-log-file-integrity/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.7">
    
    
      
        <title>AWS Api Gateway - CloudSpace workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.4b4a2bd9.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-gateway-integration-with-lambda-mock-and-aws-service-integrations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CloudSpace workshop" class="md-header__button md-logo" aria-label="CloudSpace workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CloudSpace workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AWS Api Gateway
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CloudSpace workshop" class="md-nav__button md-logo" aria-label="CloudSpace workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CloudSpace workshop
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            DevOps
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps Beginner
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            DevOps Beginner
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dockerbeginning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Beginner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../dockercomposebeginning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker Compose Beginner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Kubernetes-Minikube%20Cluster%20Beginner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes-Minikube Cluster Beginner
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../CI-CD-Beginner/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CI/CD Pipeline
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Monitoring-with-Prometheus/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Monitoring with Prometheus
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Terraform-Starter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terraform Starter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Ansible-Playbook-Library/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ansible Playbook Library
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Logging-with-ELK-Stack/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Logging with ELK Stack
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Scan-Docker-Container/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scan Docker container
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-lambda-s3-events/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Lambda S3 Events
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-lambda-xray/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Lambda Xray
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-pet-rekognition-ecr/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Pet Rekognition Ecr
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-lex-lambda-rds/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Lex Lambda Rds
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-dynamodb-lambda-trigger/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Dynamodb Lambda Trigger
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps Expert
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            DevOps Expert
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_1" >
        
          
          <label class="md-nav__link" for="__nav_3_2_1" id="__nav_3_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    DevOps Large Projects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2_1">
            <span class="md-nav__icon md-icon"></span>
            DevOps Large Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../AWS%20Photo%20Gallery%20Application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS DevOps Expert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Open%20Source%20Photo%20Gallery%20Application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Open Source DevOps Expert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Banking%20Web%20Application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Load Balancing Expert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../AWS%20E-Commerce%20Application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Full Stack DevOps Expert
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../Real-Time%20Chat%20Application/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Real-Time Application DevOps Expert
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solution Architect
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Solution Architect
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Solution Architect Projects
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Solution Architect Projects
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    AWS Api Gateway
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-cloudtrail-log-file-integrity/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Cloudtrail Log File Integrity
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-control-tower/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Control Tower
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-cognito-web-identity-federation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Cognito Web Identity Federation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-dms-database-migration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Dms Database Migration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-patch-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Patch Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-efs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Efs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-elastic-disaster-recovery/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Elastic Disaster Recovery
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-global-accelerator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Global Accelerator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-iam-scp-permissions-boundary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Iam Scp Permissions Boundary
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-macie/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Macie
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-systems-manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Systems Manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-video-on-demand/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Video On Demand
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-vpc-flow-logs/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Vpc Flow Logs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../aws-waf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AWS Waf
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="api-gateway-integration-with-lambda-mock-and-aws-service-integrations">API Gateway integration with Lambda, Mock, and AWS Service integrations</h1>
<h1 id="overview">Overview</h1>
<p>We’re going to set up an API Gateway REST API, with a few different endpoints, including Mock, Lambda, and AWS service (SNS) integrations.</p>
<p>You can read about the differences between REST and HTTP APIs here: <a href="https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vs-rest.html">https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-vs-rest.html</a></p>
<p>For this demo we will use REST, because it allows the use of Mock integrations.</p>
<p>I will be creating this in the ap-southeast-2 region, so all links to the console will be there. Make sure you change region if you’re deploying elsewhere.</p>
<h1 id="instructions">Instructions</h1>
<h2 id="stage-1-setting-up-sns">Stage 1 - Setting up SNS</h2>
<p>Head to the SNS console: <a href="https://ap-southeast-2.console.aws.amazon.com/sns/v3/home?region=ap-southeast-2#/topics">https://ap-southeast-2.console.aws.amazon.com/sns/v3/home?region=ap-southeast-2#/topics</a></p>
<p>Click on <kbd>Create topic</kbd></p>
<p>Set the <em>Type</em> to “Standard”</p>
<p>Set the <em>Name</em> to be “API-Messages”</p>
<p>Under <em>Access policy</em>, leave the <em>Method</em> as “Basic”</p>
<p>Change <em>Define who can publish messages to the topic</em> to “Only the specified AWS accounts” and enter your account ID (found in the top right of the console)</p>
<p>Change <em>Define who can subscribe to this topic</em> to “Only the specified AWS accounts” and enter your account ID again</p>
<p><em>In the real world, this should be locked down further to only the resources you want publishing to the topic, but in this temporary example set up, locking down to just the account is fine and safe enough</em></p>
<p>Leave all other options as default</p>
<p>Click on <kbd>Create topic</kbd></p>
<p>On the next page, click on <kbd>Create subscription</kbd></p>
<p>Change the <em>Protocol</em> to “Email”</p>
<p>In the <em>Endpoint</em> field, enter your personal email</p>
<p>Click <kbd>Create subscription</kbd></p>
<p>You will receive a confirmation email shortly after, with a link you need to click on. This tells SNS that you’re happy to receive emails from the topic, and prevents spam from being sent via SNS.</p>
<p><em>Side note: While writing this, my confirmation went to Spam in Gmail, so don’t forget to check there.</em></p>
<p>Your subscription should now be in the Confirmed state:</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled.png" /></p>
<h2 id="stage-2-create-the-lambda">Stage 2 - Create the Lambda</h2>
<p>Head to the Lambda console: <a href="https://ap-southeast-2.console.aws.amazon.com/lambda/home?region=ap-southeast-2#/functions">https://ap-southeast-2.console.aws.amazon.com/lambda/home?region=ap-southeast-2#/functions</a></p>
<p>Click <kbd>Create function</kbd></p>
<p>Leave <em>Author from scratch</em> selected</p>
<p>Set the <em>Function name</em> to <code>api-return-ip</code></p>
<p>Set the <em>Runtime</em> to “Python 3.9”</p>
<p>Leave the <em>Architecture</em> as “x86_64”</p>
<p>Click <kbd>Create function</kbd></p>
<p>In the <em>Code</em> tab, enter the following code:</p>
<pre><code class="language-python">def lambda_handler(event, context):   
    return {
        'statusCode': 200,
        'headers': {},
        'body': event['requestContext']['identity']['sourceIp'],
        'isBase64Encoded': False
        }
</code></pre>
<p>This is an extremely basic function that <em>just</em> returns the source IP of the requester (you).</p>
<p>Don’t forget to click <kbd>Deploy</kbd> to save the function.</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%201.png" /></p>
<h2 id="stage-3-create-the-api">Stage 3 - Create the API</h2>
<p>Head to the API Gateway console: https://ap-southeast-2.console.aws.amazon.com/apigateway/main/apis?region=ap-southeast-2</p>
<p>Click <kbd>Create API</kbd></p>
<p>Select REST API → <kbd>Build</kbd></p>
<p>Make sure you don’t select “REST API Private”.</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%202.png" /></p>
<p>Leave the Protocol and “Create new API” options as is, and set your API name to whatever you like</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%203.png" /></p>
<p>Click <kbd>Create API</kbd></p>
<p>Once that’s done you will see all of the “Resources” (endpoints / API paths), right now we have none, so click on <kbd>Actions</kbd> and then “Create Resource”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%204.png" /></p>
<p>This first resource we create will be for the Mock integration, so we’ll just name it “Mock”. The Resource Path is the URL path you will use to call it, so in this case it would be something like</p>
<p><code>https://abcdef1234.execute-api.ap-southeast-2.amazonaws.com/mock</code></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%205.png" /></p>
<p>Next we have to attach a Method. A Method is the HTTP method that the resource (path) will accept, such as “GET”, “POST”, “DELETE”, etc.</p>
<p>For the Mock integration, we will just use “GET”. </p>
<p>Make sure you are in the /mock resource</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%206.png" /></p>
<p>Then click <kbd>Actions</kbd> then “Create Method”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%207.png" /></p>
<p>Select “GET”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%208.png" /></p>
<p>Then click the tick to accept.</p>
<p>Once that’s done, API Gateway will present a list of possible integrations. For this one, select “Mock” then click <kbd>Save</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%209.png" /></p>
<p>Once that’s done, click on “Integration Response”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2010.png" /></p>
<p>This is where we tell API Gateway what the Mock integration should respond with. </p>
<p>Expand the 200 status line, then the Mapping Templates section, and set the <em>Content-Type</em> to <code>application/json</code></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2011.png" /></p>
<p>Click on the tick, then in the template section, enter the following (you can replace the message with whatever you like)</p>
<pre><code class="language-bash">{
    &quot;statusCode&quot;: 200,
    &quot;message&quot;: &quot;This response is mocking you&quot;
}
</code></pre>
<p>Then click <kbd>Save</kbd> (it won’t give any feedback that it’s saved, but it has)</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2012.png" /></p>
<p>Then click <kbd>Save</kbd> on the method response</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2013.png" /></p>
<p>That’s all done. Now we’ll set up the Lambda integration.</p>
<p>Go back to the <em>root</em> (<code>/</code>)resource</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2014.png" /></p>
<p>Then click <kbd>Actions</kbd> then <kbd>Create Resource</kbd></p>
<p>For this one, set the resource name to “Lambda”, and leave the Resource Path as “/lambda”</p>
<p>Click <kbd>Create Resource</kbd></p>
<p>Click on <kbd>Actions</kbd> then <kbd>Create Method</kbd>. This will also be a “GET”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2015.png" /></p>
<p>On the next page, set the “Integration type” to “Lambda function”</p>
<p>Enable “Use Lambda Proxy integration”</p>
<p>Once you click the “Lambda Function” text field, it should drop down with a list of Lambda’s in that region, select the one you created earlier</p>
<p>Leave all other options as is, and click <kbd>Save</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2016.png" /></p>
<p>You should see a popup telling you that you’re about to give API Gateway permission to invoke your Lambda, click <kbd>OK</kbd></p>
<p>Lastly we’ll set up another resource for SNS.</p>
<p>For this one, we will need to set up an IAM role that API Gateway will use to publish messages to SNS. </p>
<p>Head to the IAM Console: <a href="https://us-east-1.console.aws.amazon.com/iamv2/home?region=ap-southeast-2#/roles">https://us-east-1.console.aws.amazon.com/iamv2/home?region=ap-southeast-2#/roles</a></p>
<p>Go to the Roles page, and click <kbd>Create Role</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2017.png" /></p>
<p>Under “Trusted entity”, select “AWS Service”, and in the drop-down, select API Gateway. Make sure you select the radio button for “API Gateway” as well.</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2018.png" /></p>
<p>Click <kbd>Next</kbd></p>
<p>On the Permissions page, click <kbd>Next</kbd></p>
<p>Lastly, set the role name to “api-gw-sns-role” then click <kbd>Create role</kbd></p>
<p>Now go into the role you just created</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2019.png" /></p>
<p>Click on <kbd>Add permissions</kbd> then <kbd>Create inline policy</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2020.png" /></p>
<p>Go to the JSON tab and enter the following</p>
<pre><code class="language-bash">{
    &quot;Version&quot;: &quot;2012-10-17&quot;,
    &quot;Statement&quot;: [
        {
            &quot;Effect&quot;: &quot;Allow&quot;,
            &quot;Action&quot;: &quot;sns:Publish&quot;,
            &quot;Resource&quot;: &quot;*&quot;
        }
    ]
}
</code></pre>
<p>Click <kbd>Review policy</kbd></p>
<p>Under “Review policy” set the name to “SnsPublish” and click <kbd>Create policy</kbd></p>
<p>On the summary page, copy the ARN of the role you just created, you will need it for the next step</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2021.png" /></p>
<p>Now head back to the API Gateway console: https://ap-southeast-2.console.aws.amazon.com/apigateway/main/apis?region=ap-southeast-2</p>
<p>Go back into your REST API</p>
<p>Go back to the <em>root</em> resource</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2022.png" /></p>
<p>Then click <kbd>Actions</kbd> then <kbd>Create Resource</kbd></p>
<p>For this one, set the resource name to “SNS”, and leave the Resource Path as “/sns”</p>
<p>Click <kbd>Create Resource</kbd></p>
<p>Click on <kbd>Actions</kbd> then <kbd>Create Method</kbd>. </p>
<p>This one will be a “POST”.</p>
<p>On the next page, set the “Integration type” to “AWS Service”</p>
<p>Set the AWS Region as the same region as your API / SNS (for me this is ap-southeast-2)</p>
<p>Set the AWS Service as “Simple Notification Service (SNS)”</p>
<p>Leave the AWS Subdomain blank</p>
<p>Set the HTTP method to POST</p>
<p>Leave the Action Type as “Use action name”</p>
<p>Set the “Action” to “Publish”</p>
<p>Under Execution Role you need to put the ARN of the IAM role you just created for SNS.  </p>
<p>Leave the rest of the form as is, and click <kbd>Save</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2023.png" /></p>
<p>If you’re wondering where we got the “Publish” action, and where to find other Action types, you can view them all in the API Reference for the service: <a href="https://docs.aws.amazon.com/sns/latest/api/API_Operations.html">https://docs.aws.amazon.com/sns/latest/api/API_Operations.html</a></p>
<p>There’s a few ways to pass your message through API Gateway to the AWS service, but to make things easy for this example, we’re going to use Query Strings. Query Strings are found in the URL of websites after a question mark, e.g. <code>https://google.com/search?q=hello</code>, where “q=hello” is the query string.</p>
<p>Go to the “/sns” resource, and the “POST” method, and click “Method Request” </p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2024.png" /></p>
<p>Under “URL Query String Parameters” click “Add query string” and enter “TopicArn” and click the tick.</p>
<p>Then click “Add query string” and enter “Message” and click the tick.</p>
<p>Your query string should look like this</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2025.png" /></p>
<p>Go back to the “/sns” resource, and the “POST” method, and click “Integration Request”</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2026.png" /></p>
<p>Under “URL Query String Parameters” click “Add query string” </p>
<p>Set the Name to “Message” and the Mapped from to <code>method.request.querystring.Message</code></p>
<p>Click the tick to save</p>
<p>Click “Add query string” again</p>
<p>Set the Name to “TopicArn” and the Mapped from to <code>method.request.querystring.TopicArn</code></p>
<p>Click the tick to save</p>
<p>Now we need to Deploy the API. </p>
<p>Click on <kbd>Actions</kbd>, then <kbd>Deploy API</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2027.png" /></p>
<p>In the pop up window, set the “Deployment stage” to “[New Stage]”, and the “Stage name” to “v1”.</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2028.png" /></p>
<p>The “Stage name” can really be anything, and is used to direct API requests to different “versions” of the API. So you could have a “dev” stage, and “prod” stage, or just use the standard “v1”, “v2”, etc.</p>
<p>Click <kbd>Deploy</kbd></p>
<p>Once that’s done, you will be sent to the Stage Editor page, where you can set things like Rate Limiting, WAF associations, caching, logs, etc. We don’t need to change any of these for this demo.</p>
<p>At the top of the screen you will see your API URL</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2029.png" /></p>
<p>Copy that URL for the next step.</p>
<h2 id="stage-4-testing-the-api">Stage 4 - Testing the API</h2>
<p>The Lambda and Mock resources can be tested in the browser. By default, any URL you enter into your browser performs a GET request (and remember, only our Lambda and Mock resources have the GET method set).</p>
<h3 id="mock">Mock</h3>
<p>If we visit our API URL and append “/mock” we should see the response we entered earlier</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2030.png" /></p>
<p>The reason we want a JSON output rather than a friendly human readable one, is because working with JSON in programming languages makes things much easier. Your code or application could read the “statusCode” key and see a 200 value, and then it could read the “message” key and see it’s value.</p>
<h3 id="lambda">Lambda</h3>
<p>Now if we visit our “/lambda” URL we should see our function response (your IP address)</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2031.png" /></p>
<h3 id="sns">SNS</h3>
<p>For the last endpoint, we can’t use a browser because browsers by default only perform “GET” requests, so we have a couple of options to test this endpoint.</p>
<h3 id="command-line">Command Line</h3>
<p>If you’re comfortable using the command line (Linux, Mac, or WSL for Windows), follow these steps. If you would prefer to use a GUI, skip ahead.</p>
<p>In your CLI, run the following command (replace “REGION” and “ACCOUNT-ID” with your region and account ID), and don’t forget to replace the URL with your API gateway URL</p>
<pre><code class="language-python">curl -X POST -G -d 'TopicArn=arn:aws:sns:REGION:ACCOUNT-ID:API-Messages' -d 'Message=Hello!'  https://abc123def.execute-api.ap-southeast-2.amazonaws.com/v1/sns
</code></pre>
<p><em>Note</em> if you want to use spaces in your message, because query parameters are URL encoded, spaces need to be replaced with a +, so for example:</p>
<pre><code class="language-python">curl -X POST -G -d 'TopicArn=arn:aws:sns:REGION:ACCOUNT-ID:API-Messages' -d 'Message=I+like+sending+long+messages'  https://abc123def.execute-api.ap-southeast-2.amazonaws.com/v1/sns
</code></pre>
<h3 id="gui-aws-console">GUI (AWS Console)</h3>
<p>The API Gateway console provides a handy way to test your API. </p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2032.png" /></p>
<p>On the testing page, under “Query Strings”, enter the following. Replace the TopicArn with your SNS Topic ARN, and the message with whatever you like.</p>
<pre><code class="language-python">TopicArn=arn:aws:sns:REGION:ACCOUNT-ID:API-Messages&amp;Message=APIs+are+fun
</code></pre>
<p><em>Note</em> if you want to use spaces in your message, because query parameters are URL encoded, spaces need to be replaced with a +</p>
<p>Scroll down and click <kbd>Test</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2033.png" /></p>
<h3 id="gui-postman">GUI (Postman)</h3>
<p>We can also use a popular API testing tool called Postman. It’s available for Windows, Mac, and Linux</p>
<p>It can be downloaded for free from their website: <a href="https://www.postman.com/downloads/">https://www.postman.com/downloads/</a></p>
<p>I won’t write instructions on installing the program, it’s fairly self explanatory and isn’t related to this demo.</p>
<p>Once you’ve opened Postman, click on the + up the top of the application to open a new tab. Set the method to POST, and enter your API Gateway URL.</p>
<p>You can then enter the two Query Parameters we set earlier:</p>
<p><code>TopicArn</code> which is the ARN of your SNS topic.</p>
<p><code>Message</code> which is the message you want to send to the topic</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2034.png" /></p>
<p>Once you’ve entered all that, hit <kbd>Send</kbd></p>
<p>No matter which method you chose, you should receive an email from SNS containing the message in your Query String</p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2035.png" /></p>
<h2 id="stage-5-cleaning-up">Stage 5 - Cleaning up</h2>
<p>Head to the API Gateway console: <a href="https://ap-southeast-2.console.aws.amazon.com/apigateway/main/apis?region=ap-southeast-2">https://ap-southeast-2.console.aws.amazon.com/apigateway/main/apis?region=ap-southeast-2</a></p>
<p>Select the API you created, and click <kbd>Actions</kbd> then <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2036.png" /></p>
<p>Head to the SNS console: <a href="https://ap-southeast-2.console.aws.amazon.com/sns/v3/home?region=ap-southeast-2#/topics">https://ap-southeast-2.console.aws.amazon.com/sns/v3/home?region=ap-southeast-2#/topics</a></p>
<p>Go to <em>Topics</em>, select the Topic you created earlier, and click <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2037.png" /></p>
<p>In the confirmation box, enter “delete me” and click <kbd>Delete</kbd></p>
<p>Go to <em>Subscriptions</em>, select the Subscription you created for your email, and click <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2038.png" /></p>
<p>Head to the IAM console: <a href="https://us-east-1.console.aws.amazon.com/iamv2/home?region=ap-southeast-2#/roles">https://us-east-1.console.aws.amazon.com/iamv2/home?region=ap-southeast-2#/roles</a></p>
<p>Under <em>Roles</em>, search for "api-gw-sns-role”</p>
<p>Select the role we created earlier, and click <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2039.png" /></p>
<p>Type “api-gw-sns-role” into the confirmation field, and click <kbd>Delete</kbd></p>
<p>Head to the Lambda console: <a href="https://ap-southeast-2.console.aws.amazon.com/lambda/home?region=ap-southeast-2#/functions">https://ap-southeast-2.console.aws.amazon.com/lambda/home?region=ap-southeast-2#/functions</a></p>
<p>Select the function we created earlier, and click <kbd>Actions</kbd> then <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2040.png" /></p>
<p>Enter “delete” in the confirmation window, and then click <kbd>Delete</kbd></p>
<p>Head to the Cloudwatch Logs console: <a href="https://ap-southeast-2.console.aws.amazon.com/cloudwatch/home?region=ap-southeast-2#logsV2:log-groups">https://ap-southeast-2.console.aws.amazon.com/cloudwatch/home?region=ap-southeast-2#logsV2:log-groups</a></p>
<p>Search for the "api-return-ip” Log Group, select the log group , click <kbd>Actions</kbd> then <kbd>Delete</kbd></p>
<p><img alt="Untitled" src="../assets/images/aws-api-gateway/Untitled%2041.png" /></p>
<p>In the confirmation popup, click <kbd>Delete</kbd></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>